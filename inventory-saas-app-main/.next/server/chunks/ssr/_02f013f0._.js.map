{"version":3,"sources":["../../../../node_modules/next/src/build/webpack/loaders/next-flight-loader/server-reference.ts","../../../../node_modules/next/src/build/webpack/loaders/next-flight-loader/action-validate.ts","../../../../app/dashboard/logout-action.ts","../../../../app/dashboard/items/actions.tsx","../../../../.next-internal/server/app/dashboard/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["/* eslint-disable import/no-extraneous-dependencies */\nexport { registerServerReference } from 'react-server-dom-webpack/server'\n","// This function ensures that all the exported values are valid server actions,\n// during the runtime. By definition all actions are required to be async\n// functions, but here we can only check that they are functions.\nexport function ensureServerEntryExports(actions: any[]) {\n  for (let i = 0; i < actions.length; i++) {\n    const action = actions[i]\n    if (typeof action !== 'function') {\n      throw new Error(\n        `A \"use server\" file can only export async functions, found ${typeof action}.\\nRead more: https://nextjs.org/docs/messages/invalid-use-server-value`\n      )\n    }\n  }\n}\n","\"use server\";\n\nimport { redirect } from \"next/navigation\";\nimport { createSupabaseServerClient } from \"@/app/lib/supabase-server\";\n\nexport async function logout() {\n  const supabase = await createSupabaseServerClient();\n  await supabase.auth.signOut();\n  redirect(\"/login\");\n}\n","\"use server\"\n\nimport { createSupabaseServerClient } from \"@/app/lib/supabase-server\"\nimport { getProfile } from \"@/app/lib/get-profile\"\n\nexport async function getItems() {\n  const supabase = await createSupabaseServerClient()\n  const me = await getProfile()\n  if (!me) throw new Error(\"Not authenticated\")\n\n  \n\n\n  const { data } = await supabase\n    .from(\"items\")\n    .select(\"*\")\n    .eq(\"user_id\", me.id)\n    .order(\"created_at\", { ascending: false })\n\n  return data\n}\n\nexport async function addItem(formData: FormData) {\n  const supabase = await createSupabaseServerClient()\n  const me = await getProfile()\n  if (!me) throw new Error(\"Not authenticated\")\n\n  const name = formData.get(\"name\") as string\n  const quantity = Number(formData.get(\"quantity\"))\n\n  await supabase.from(\"items\").insert({\n    user_id: me.id,\n    name,\n    quantity,\n  })\n}\n\nfunction parseCsvRows(text: string): string[][] {\n  const rows: string[][] = []\n  let row: string[] = []\n  let cell = \"\"\n  let inQuotes = false\n\n  for (let i = 0; i < text.length; i += 1) {\n    const char = text[i]\n    const next = text[i + 1]\n\n    if (char === '\"') {\n      if (inQuotes && next === '\"') {\n        cell += '\"'\n        i += 1\n      } else {\n        inQuotes = !inQuotes\n      }\n      continue\n    }\n\n    if (char === \",\" && !inQuotes) {\n      row.push(cell)\n      cell = \"\"\n      continue\n    }\n\n    if ((char === \"\\n\" || char === \"\\r\") && !inQuotes) {\n      if (char === \"\\r\" && next === \"\\n\") i += 1\n      row.push(cell)\n      rows.push(row)\n      row = []\n      cell = \"\"\n      continue\n    }\n\n    cell += char\n  }\n\n  if (cell.length > 0 || row.length > 0) {\n    row.push(cell)\n    rows.push(row)\n  }\n\n  return rows\n}\n\nexport async function importItems(formData: FormData) {\n  const supabase = await createSupabaseServerClient()\n  const me = await getProfile()\n  if (!me) throw new Error(\"Not authenticated\")\n\n  const file = formData.get(\"csvFile\")\n  if (\n    !file ||\n    typeof file !== \"object\" ||\n    !(\"text\" in file) ||\n    !(\"size\" in file) ||\n    typeof file.text !== \"function\" ||\n    typeof file.size !== \"number\" ||\n    file.size === 0\n  ) {\n    throw new Error(\"CSV file is required\")\n  }\n\n  const csvFile = file as { text: () => Promise<string>; size: number }\n  const text = await csvFile.text()\n  const rows = parseCsvRows(text).filter((row) => row.some((cell) => cell.trim() !== \"\"))\n  if (rows.length < 2) throw new Error(\"CSV must include a header and at least one row\")\n\n  const header = rows[0].map((h) => h.trim().toLowerCase())\n  const nameIndex = header.indexOf(\"name\")\n  const quantityIndex = header.indexOf(\"quantity\")\n  if (nameIndex === -1 || quantityIndex === -1) {\n    throw new Error(\"CSV must contain name and quantity columns\")\n  }\n\n  const inserts = rows\n    .slice(1)\n    .map((row) => {\n      const name = (row[nameIndex] ?? \"\").trim()\n      const quantity = Number(row[quantityIndex] ?? \"\")\n      if (!name || !Number.isFinite(quantity) || quantity < 0) return null\n      return { user_id: me.id, name, quantity }\n    })\n    .filter((entry): entry is { user_id: string; name: string; quantity: number } => entry !== null)\n\n  if (!inserts.length) {\n    throw new Error(\"No valid rows found in CSV\")\n  }\n\n  await supabase.from(\"items\").insert(inserts)\n\n  await supabase.from(\"audit_logs\").insert({\n    actor_id: me.id,\n    action: \"IMPORTED_ITEMS\",\n    target: `${inserts.length} rows`,\n  })\n}\n\nexport async function deleteItem(formData: FormData) {\n  const supabase = await createSupabaseServerClient()\n  const me = await getProfile()\n\n  if (!me || me.role !== \"admin\") {\n    throw new Error(\"Not allowed\")\n  }\n\n  const id = Number(formData.get(\"id\"))\n\n  const { data: item } = await supabase\n    .from(\"items\")\n    .select(\"name\")\n    .eq(\"id\", id)\n    .single<{ name: string }>()\n\n  await supabase.from(\"items\").delete().eq(\"id\", id)\n\n  await supabase.from(\"audit_logs\").insert({\n    actor_id: me.id,\n    action: \"DELETED_ITEM\",\n    target: item?.name ?? `Item ${id}`,\n  })\n}\n\nexport async function updateItem(formData: FormData) {\n  const supabase = await createSupabaseServerClient()\n  const me = await getProfile()\n\n  if (!me) throw new Error(\"Not authenticated\")\n\n  const id = Number(formData.get(\"id\"))\n  const name = formData.get(\"name\") as string\n  const quantity = Number(formData.get(\"quantity\"))\n\n  await supabase.from(\"items\").update({ name, quantity }).eq(\"id\", id)\n\n  await supabase.from(\"audit_logs\").insert({\n    actor_id: me.id,\n    action: \"UPDATED_ITEM\",\n    target: `Item ${id}`,\n  })\n}\n","export {logout as '001130e10d4eee3c57bdbe243e47dcecd75ee72810'} from 'ACTIONS_MODULE0'\nexport {getItems as '001418c00776d3dcf1fabd1eb0220371d7ec966730'} from 'ACTIONS_MODULE1'\nexport {deleteItem as '402ba70d10209d9fa5c36b78cfe23378d2fb5a040b'} from 'ACTIONS_MODULE1'\nexport {addItem as '409ab395cf882985090ad88d94091c700a8e05eb33'} from 'ACTIONS_MODULE1'\nexport {updateItem as '40b63e78d26dffe07382a6732bec3b494a64c87812'} from 'ACTIONS_MODULE1'\nexport {importItems as '40bcf8930122b9e89881f990bc185d432af2dfd301'} from 'ACTIONS_MODULE1'\n"],"names":["registerServerReference","ensureServerEntryExports","actions","i","length","action","Error"],"mappings":"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","ignoreList":[0,1]}