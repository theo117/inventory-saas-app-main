{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/theod/Documents/Java%202025/business/New%20folder/inventory-saas-app-main/inventory-saas-app-main/app/dashboard/logout-action.ts"],"sourcesContent":["\"use server\";\n\nimport { redirect } from \"next/navigation\";\nimport { createSupabaseServerClient } from \"@/app/lib/supabase-server\";\n\nexport async function logout() {\n  const supabase = await createSupabaseServerClient();\n  await supabase.auth.signOut();\n  redirect(\"/login\");\n}\n"],"names":[],"mappings":";;;;;AAEA;AAAA;AACA;;;;;AAEO,eAAe;IACpB,MAAM,WAAW,MAAM,IAAA,8JAA0B;IACjD,MAAM,SAAS,IAAI,CAAC,OAAO;IAC3B,IAAA,iMAAQ,EAAC;AACX;;;IAJsB;;AAAA,+OAAA"}},
    {"offset": {"line": 30, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/theod/Documents/Java%202025/business/New%20folder/inventory-saas-app-main/inventory-saas-app-main/app/dashboard/users/actions.ts"],"sourcesContent":["\"use server\"\n\nimport { getProfile } from \"@/app/lib/get-profile\"\nimport { revalidatePath } from \"next/cache\"\nimport { createClient } from \"@supabase/supabase-js\"\n\nconst ALLOWED_ROLES = new Set([\"admin\", \"staff\"])\n\nfunction createSupabaseAdminClient() {\n  const url = process.env.NEXT_PUBLIC_SUPABASE_URL\n  const serviceRoleKey = process.env.SUPABASE_SERVICE_ROLE_KEY\n\n  if (!url || !serviceRoleKey) {\n    throw new Error(\"Missing NEXT_PUBLIC_SUPABASE_URL or SUPABASE_SERVICE_ROLE_KEY\")\n  }\n\n  return createClient(url, serviceRoleKey)\n}\n\nexport async function updateUserRole(formData: FormData) {\n  const supabase = createSupabaseAdminClient()\n  const me = await getProfile()\n  if (!me || me.role !== \"admin\") throw new Error(\"Not allowed\")\n\n  const userId = String(formData.get(\"userId\") ?? \"\")\n  const role = String(formData.get(\"role\") ?? \"\")\n\n  if (!userId || !ALLOWED_ROLES.has(role)) {\n    throw new Error(\"Invalid role update\")\n  }\n\n  if (userId === me.id && role !== \"admin\") {\n    throw new Error(\"Cannot demote your own admin account\")\n  }\n\n  const { data: targetUser, error: targetError } = await supabase\n    .from(\"profiles\")\n    .select(\"id, role\")\n    .eq(\"id\", userId)\n    .maybeSingle<{ id: string; role: string }>()\n\n  if (targetError) {\n    throw new Error(`Unable to read target user: ${targetError.message}`)\n  }\n\n  if (!targetUser) {\n    throw new Error(\"Target user not found or not visible by policy\")\n  }\n\n  const { data: updatedRow, error: updateError } = await supabase\n    .from(\"profiles\")\n    .update({ role })\n    .eq(\"id\", userId)\n    .select(\"id\")\n    .maybeSingle()\n\n  if (updateError) {\n    throw new Error(`Role update failed: ${updateError.message}`)\n  }\n\n  if (!updatedRow) {\n    throw new Error(\"Role update affected 0 rows. Check profiles UPDATE policy (RLS).\")\n  }\n\n  const { error: auditError } = await supabase.from(\"audit_logs\").insert({\n    actor_id: me.id,\n    action: \"UPDATED_USER_ROLE\",\n    target: `${userId}:${role}`,\n  })\n\n  if (auditError) {\n    throw new Error(`Audit log failed: ${auditError.message}`)\n  }\n\n  revalidatePath(\"/dashboard/users\")\n}\n\nexport async function promoteUser(userId: string) {\n  const supabase = createSupabaseAdminClient()\n  const me = await getProfile()\n  if (!me || me.role !== \"admin\") throw new Error(\"Not allowed\")\n  if (userId === me.id) throw new Error(\"Cannot change your own role\")\n\n  const { error: updateError } = await supabase\n    .from(\"profiles\")\n    .update({ role: \"admin\" })\n    .eq(\"id\", userId)\n\n  if (updateError) {\n    throw new Error(`Promote failed: ${updateError.message}`)\n  }\n\n  const { error: auditError } = await supabase.from(\"audit_logs\").insert({\n    actor_id: me.id,\n    action: \"PROMOTED_USER\",\n    target: userId,\n  })\n\n  if (auditError) {\n    throw new Error(`Audit log failed: ${auditError.message}`)\n  }\n\n  revalidatePath(\"/dashboard/users\")\n}\n\nexport async function demoteUser(userId: string) {\n  const supabase = createSupabaseAdminClient()\n  const me = await getProfile()\n  if (!me || me.role !== \"admin\") throw new Error(\"Not allowed\")\n  if (userId === me.id) throw new Error(\"Cannot change your own role\")\n\n  const { error: updateError } = await supabase\n    .from(\"profiles\")\n    .update({ role: \"staff\" })\n    .eq(\"id\", userId)\n\n  if (updateError) {\n    throw new Error(`Demote failed: ${updateError.message}`)\n  }\n\n  const { error: auditError } = await supabase.from(\"audit_logs\").insert({\n    actor_id: me.id,\n    action: \"DEMOTED_USER\",\n    target: userId,\n  })\n\n  if (auditError) {\n    throw new Error(`Audit log failed: ${auditError.message}`)\n  }\n\n  revalidatePath(\"/dashboard/users\")\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 152, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/theod/Documents/Java%202025/business/New%20folder/inventory-saas-app-main/inventory-saas-app-main/.next-internal/server/app/dashboard/users/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {logout as '005b4deac13a0b8c16d5cf280aa14e7f3d3fe01960'} from 'ACTIONS_MODULE0'\nexport {demoteUser as '400e770815a0db3169cf74707fd7525c7ab59fdff0'} from 'ACTIONS_MODULE1'\nexport {promoteUser as '407cf11958b164250ca933e461d15b7052fa267197'} from 'ACTIONS_MODULE1'\nexport {updateUserRole as '40cdfe61fc21370a74c4da81d07591a7bc14eb1043'} from 'ACTIONS_MODULE1'\n"],"names":[],"mappings":";AAAA;AACA"}}]
}